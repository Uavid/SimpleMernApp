ðŸ‘‰ How to Build & Deploy (Very Simple Steps)

Step 1 â€” Start Minikube
minikube start --driver=docker

Step 2 â€” Enable Ingress
minikube addons enable ingress

Step 3 â€” Build Docker Images Inside Minikube
eval $(minikube docker-env)

docker build -t backend-image:1.0 ./backend
docker build -t frontend-image:1.0 ./frontend

Step 4 â€” Apply All Kubernetes Files
kubectl apply -f k8s/

Step 5 â€” Get Minikube IP
minikube ip


Example output:

192.168.49.2

ðŸš€ Now open the app:

ðŸ‘‰ http://192.168.49.2

It will show:

Frontend Running âœ”
Backend says: Hello from Backend ðŸš€








âœ… 1. Delete All Kubernetes Resources

Run this to remove everything in Minikubeâ€™s Kubernetes cluster:

Delete all deployments
kubectl delete deployment --all

Delete all services (except Kubernetes default service)
kubectl delete svc --all

Delete all pods
kubectl delete pod --all

Delete ingress
kubectl delete ingress --all

Delete configmaps & secrets
kubectl delete configmap --all
kubectl delete secret --all

âœ… 2. Delete All Docker Images Inside Minikube

Switch docker to Minikube:

eval $(minikube docker-env)


Then list and delete all images:

docker images
docker rmi -f $(docker images -q)

âœ… 3. Completely Reset Minikube (FULL CLEAN-UP)
Stop Minikube
minikube stop

Delete Minikube cluster
minikube delete --all --purge

ðŸ”¥ (Optional but Recommended) Restart Minikube Clean
minikube start

ðŸ”§ Now re-enable ingress (since it resets after delete)
minikube addons enable ingress

ðŸ’¡ After Reset, it will be fresh like new.

Now Jenkins can:

Build fresh docker images

Apply fresh deployments

No old pods/containers

No old services

No old ingress


âœ” To delete ALL of them safely: delete the Minikube cluster.

You cannot remove those images while Minikube is running because Kubernetes core components are using them.

âœ… Fix: Completely Wipe Minikube (Safe & Clean)
1. Stop Minikube
minikube stop

2. Delete the cluster
minikube delete --purge --all


This will remove:

âœ” All containers
âœ” All images
âœ” All volumes
âœ” All pods
âœ” All K8s system components

ðŸ”¥ Now switch Docker back to your HOST (important)

After deleting minikube, run:

eval $(minikube docker-env -u)


This resets Docker back to the host machine.

ðŸ§¹ Now delete all remaining local Docker images

(You will now be deleting images from your host, not from Minikubeâ€™s internal env)

docker rmi -f $(docker images -aq)


This time no image is locked, so everything will get deleted.

ðŸš€ Recreate Minikube fresh
minikube start


Enable ingress again:

minikube addons enable ingress


Now your Minikube environment is completely fresh and ready for Jenkins deployment.


To Uninstall minikube and kubectl

ðŸ§¹ STEP 1 â€” Stop Minikube (if running)
minikube stop
minikube delete --all


Ignore errors if Minikube is not running.

ðŸ§¹ STEP 2 â€” Uninstall Minikube
If installed via apt:
sudo apt purge minikube -y
sudo apt autoremove -y

If installed manually (binary in /usr/local/bin):
sudo rm -f /usr/local/bin/minikube
sudo rm -f /usr/bin/minikube

Delete minikube folders:
rm -rf ~/.minikube
rm -rf ~/.kube

ðŸ§¹ STEP 3 â€” Uninstall kubectl
If kubectl installed via apt:
sudo apt purge kubectl -y
sudo apt autoremove -y

If kubectl installed manually:
sudo rm -f /usr/local/bin/kubectl
sudo rm -f /usr/bin/kubectl

Also remove caches:
rm -rf ~/.kube
rm -rf /etc/kubernetes

ðŸ§¹ STEP 4 â€” Remove Docker containers & images left by Minikube

(optional but recommended)

docker system prune -a --volumes -f

ðŸ§¹ STEP 5 â€” Remove systemd services (if any)
sudo rm -f /etc/systemd/system/minikube.service
sudo rm -f /etc/systemd/system/kubelet.service
sudo rm -rf /var/lib/kubelet

ðŸ§¹ STEP 6 â€” Check if everything is removed
Check kubectl:
kubectl version


â†’ Should show: command not found

Check Minikube:
minikube version


â†’ Should show: command not found

Check context:
kubectl config current-context


â†’ Should show: no KUBECONFIG


To install minikube and kubectl :
Minikube :
curl -LO https://github.com/kubernetes/minikube/releases/latest/download/minikube-linux-amd64
sudo install minikube-linux-amd64 /usr/local/bin/minikube && rm minikube-linux-amd64

Kubectl :
  curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
  curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl.sha256"
  echo "$(cat kubectl.sha256)  kubectl" | sha256sum --check
  sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl



////////////////PIPELINE





pipeline {
    agent any

    environment {
        MINIKUBE_DOCKER_ENV = "eval \$(minikube docker-env)"
        FRONTEND_IMAGE = "mern-frontend:latest"
        BACKEND_IMAGE = "mern-backend:latest"
    }

    stages {

        stage('Start Minikube') {
            steps {
                script {
                    sh """
                        if ! minikube status | grep -q 'host: Running'; then
                            echo "Starting Minikube..."
                            minikube start --driver=docker
                            minikube addons enable ingress
                        else
                            echo "Minikube already running."
                        fi
                    """
                }
            }
        }


        stage('Checkout Code') {
            steps {
                git branch: 'main', url: 'https://github.com/Uavid/SimpleMernApp.git'
            }
        }

        stage('Use Minikube Docker Daemon') {
            steps {
                sh "${MINIKUBE_DOCKER_ENV}"
            }
        }

        stage('Enable Ingress Addon') {
            steps {
                sh """
                    echo "Enabling Ingress Addon..."
                    minikube addons enable ingress
                """
            }
        }

        stage('Build Backend Docker Image') {
            steps {
                dir('backend') {
                    sh """
                        ${MINIKUBE_DOCKER_ENV}
                        docker build -t ${BACKEND_IMAGE} .
                    """
                }
            }
        }

        stage('Build Frontend Docker Image') {
            steps {
                dir('frontend') {
                    sh """
                        ${MINIKUBE_DOCKER_ENV}
                        docker build -t ${FRONTEND_IMAGE} .
                    """
                }
            }
        }

        stage('Deploy to Kubernetes') {
            steps {
                sh """
                    kubectl apply -f k8s/backend-deployment.yaml
                    kubectl apply -f k8s/backend-service.yaml
                    kubectl apply -f k8s/frontend-deployment.yaml
                    kubectl apply -f k8s/frontend-service.yaml
                    kubectl apply -f k8s/ingress.yaml
                """
            }
        }

        stage('Verify Deployment') {
            steps {
                sh "kubectl get pods -o wide"
                sh "kubectl get svc"
                sh "kubectl get ingress"
                sh "minikube ip"
            }
        }

        stage('Hello') {
            steps {
                echo 'Hello World'
            }
        }
    }
}






pipeline {
    agent any

    environment {
        MINIKUBE_DOCKER_ENV = "eval \$(minikube docker-env)"
        FRONTEND_IMAGE = "mern-frontend:latest"
        BACKEND_IMAGE = "mern-backend:latest"
    }

    stages {

        stage('Start Minikube') {
            steps {
                script {
                    sh """
                        if ! minikube status | grep -q 'host: Running'; then
                            echo "Starting Minikube..."
                            minikube start --driver=docker
                            minikube addons enable ingress
                        else
                            echo "Minikube already running."
                        fi
                    """
                }
            }
        }

        stage('Checkout Code') {
            steps {
                git branch: 'main', url: 'https://github.com/Uavid/SimpleMernApp.git'
            }
        }

        stage('Use Minikube Docker Daemon') {
            steps {
                sh "${MINIKUBE_DOCKER_ENV}"
            }
        }

        stage('Build Backend Image if Changed') {
            when {
                changeset "backend/**"
            }
            steps {
                sh """
                    echo "Backend code changed. Building backend image..."
                    docker rmi -f ${BACKEND_IMAGE} || true
                    docker build -t ${BACKEND_IMAGE} backend/
                """
                script {
                    env.BACKEND_CHANGED = "true"
                }
            }
        }

        stage('Build Frontend Image if Changed') {
            when {
                changeset "frontend/**"
            }
            steps {
                sh """
                    echo "Frontend code changed. Building frontend image..."
                    docker rmi -f ${FRONTEND_IMAGE} || true
                    docker build -t ${FRONTEND_IMAGE} frontend/
                """
                script {
                    env.FRONTEND_CHANGED = "true"
                }
            }
        }

        stage('Deploy to Kubernetes') {
            when {
                expression {
                    return env.FRONTEND_CHANGED == "true" || env.BACKEND_CHANGED == "true"
                }
            }
            steps {
                echo "Changes detected. Deploying services..."
                sh """
                    kubectl apply -f k8s/backend-deployment.yaml
                    kubectl apply -f k8s/frontend-deployment.yaml
                    kubectl apply -f k8s/ingress.yaml
                """
            }
        }

        stage('Skip If No Changes') {
            when {
                expression {
                    return !(env.FRONTEND_CHANGED == "true" || env.BACKEND_CHANGED == "true")
                }
            }
            steps {
                echo "No code changes. Skipping build & deploy."
            }
        }

        stage('Verify Deployment') {
            steps {
                sh "kubectl get pods -o wide"
                sh "kubectl get svc"
                sh "kubectl get ingress"
                sh "minikube ip"
            }
        }
    }
}
